aspf（application specific packet filter）是针对应用层的包过滤，即基于状态的报文过滤。它和普通的静态防火墙协同工作，以便于实施内部网络的安全策略。aspf能够检测试图通过防火墙的应用层协议会话信息，阻止不符合规则的数据报文穿过。
为保护网络安全，基于acl规则的包过滤可以在网络层和传输层检测数据包，防止非法入侵。aspf能够检测应用层协议的信息，并对应用的流量进行监控。


 H3C的SecPath防火墙的ASPF作为改进的状态检测安全技术，支持对多种应用协议进行检测：包括H323/MGCP/SIP/H248/RTSP/HWCC，以及ICMP、FTP、DNS、PPTP、NBT、ILS、HTTP、SMTP等。还支持对HTTP中Activex/JavaAppelt进行过滤


ASPF主要提供如下功能：

能够检查应用层协议信息
能够检测传输层协议信息
Java Blocking（Java阻断）
DoS（Denial of Service，拒绝服务）的检测和防范 
ActiveX Blocking（ActiveX阻断） 
支持端口到应用的映射，为基于应用层协议的服务指定非通用端口 
增强的会话日志功能 
	
Java Blocking
由于恶意applet会对用户的计算机系统资源的造成破坏，因而需要限制未经用户允许的Java applet下载至用户的网络中。Java 阻塞（Java Blocking）可实现对来自于不信任站点Java applet的过滤，对通过HTTP协议传输的Java applet小程序进行阻断。当配置了Java Blocking时，用户对视图在web页面中获取包含Java applet的程序而发送的请求指令将会被ASPF阻断过滤。
需要注意的是，ASPF的Java 阻断功能现在只能实现对封装成.Class的Java applet进行阻断，而对于以其它方式封装的applet不能实现过滤。
	
端口映射PAM
应用层协议使用通用的端口号进行通信。端口映射允许用户对不同的应用定义一组新的端口号。端口映射提供了一些机制来维护和使用用户定义的端口配置信息。
PAM支持两类映射机制：
①	通用端口映射是将用户自定义端口号和应用层协议建立映射关系。例如将8080端口映射为HTTP协议，这样所有目标端口是8080的TCP报文被认为是HTTP报文。
②	基于基本访问控制列表的主机端口映射是对去往或来自某些特定主机的报文建立自定义端口号和应用协议的的映射。例如，将目的地址为10.110.0.0网段的使用8080端口的TCP报文映射为HTTP报文。主机的范围由ACL基本列表指定的。
	
单通道协议/多通道协议
① 单通道协议：从会话建立到删除的全过程中，只有一个通道参与数据交互：SMTP HTTP。
② 多通道协议：包含一个控制通道和若干其它控制或者数据通道，即控制信息的交互和数据的传输在不同的通道上完成的，如FTP，RTSP。
	
内部接口和外部接口 
如果防火墙连接了内部网络和互联网，防火墙通过ASPF部署来保护内部网络的服务器，则安全网关上于内部链接的接口就是内部接口，与互联网连接的接口就是外部接口。当ASPF应用于防火墙外部接口的出方向时，可以在防火墙上为内网用户访问互联网的返回报文打开一个临时通道。




ASPF能够支持一个控制连接上存在多个数据连接，监听每一个应用的每一个连接所使用的端口，打开合适的通道让会话中的数据出入防火墙，在会话结束时则关闭该通道，从而对使用动态端口的应用实现有效的访问控制。
状态检测技术采用的是一种基于会话的状态检测机制，将属于同一会话的所有包作为一个整体的数据流看待，构成一个会话状态表。通过会话状态表与临时访问控制表的共同配合，对流经路由器特定接口的报文的各个连接状态因素加以识别判定。ASPF主要采用了会话状态表和临时访问控制表实现对传输报文的动态过滤。

会话状态表的概念：
一个会话可以被认为是一个TCP连接。会话状态表维护了一次会话中某一时刻会话所处的状态，用于匹配后续的发送报文，并检测会话状态的转换是否正确。会话状态表在检测到第一个外发报文时创建，即通过第一个SYN包建立。
会话状态表中的记录的信息既包括当前会话的通信信息，也包括是本次会话之前的通信信息。因此，与传统包过滤防火墙的静态过滤相比，ASPF考虑到会话的上下文信息，具有更好的灵活性和安全性。

临时访问控制表的概念：
临时访问控制表不同于包过滤防火墙的访问控制列表（ACL）。它独立于访问控制列表，在创建会话状态表项的时候同时创建，会话结束后删除。其功能相当于一个扩展的访问控制规则的permit项，用于匹配一个会话中的所有应答报文。 

传输层协议检测基本原理：
传输层协议检测是指通用TCP/UDP检测。通用TCP和UDP检测与应用层协议检测不同，是对报文的传输层信息进行的检测，如源、目的地址及端口号等。需要注意的是，应用层协议检测优先于传输层协议检测。通用TCP/UDP检测要求流入接口的报文与之前流出接口的报文完全匹配，即源、目的地址及端口号恰好对应，否则返回的报文将被丢弃。因此对于FTP，H.323这样的多通道应用层协议，在不配置应用层检测而直接配置TCP检测的情况下会导致数据通道无法建立.
